# Generated by Django 6.0.1 on 2026-01-14 12:38

import django.db.models.deletion
import uuid
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('customers', '0002_tenant_consumer_smartcreditconnection_creditreport_and_more'),
        ('tickets', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Dispute',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('dispute_number', models.CharField(editable=False, max_length=20, unique=True)),
                ('bureau', models.CharField(choices=[('equifax', 'Equifax'), ('experian', 'Experian'), ('transunion', 'TransUnion')], max_length=20)),
                ('type', models.CharField(choices=[('fcra_609_request', 'FCRA 609 Information Request'), ('fcra_611_accuracy', 'FCRA 611 Dispute of Accuracy'), ('method_verification', 'Method of Verification Request'), ('reinvestigation', 'Reinvestigation Follow-up'), ('goodwill_adjustment', 'Goodwill Adjustment Request'), ('pay_for_delete', 'Pay for Delete Offer'), ('identity_theft_605b', 'Identity Theft Block (605B)'), ('cfpb_complaint', 'CFPB Complaint Package'), ('generic_dispute', 'Generic Dispute')], max_length=50)),
                ('reason_codes', models.JSONField(default=list)),
                ('narrative', models.TextField(blank=True)),
                ('ai_generated', models.BooleanField(default=False)),
                ('ai_reviewed', models.BooleanField(default=False)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('pending_review', 'Pending Review'), ('approved', 'Approved'), ('mailed', 'Mailed'), ('awaiting_response', 'Awaiting Response'), ('responded', 'Bureau Responded'), ('resolved', 'Resolved'), ('escalated', 'Escalated'), ('closed', 'Closed')], default='draft', max_length=20)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('submitted_at', models.DateTimeField(blank=True, null=True)),
                ('due_at', models.DateTimeField(blank=True, null=True)),
                ('extended_due_at', models.DateTimeField(blank=True, null=True)),
                ('responded_at', models.DateTimeField(blank=True, null=True)),
                ('closed_at', models.DateTimeField(blank=True, null=True)),
                ('outcome', models.CharField(blank=True, choices=[('deleted', 'Deleted'), ('corrected', 'Corrected'), ('verified', 'Verified as Accurate'), ('no_response', 'No Response'), ('partial_correction', 'Partial Correction'), ('rejected', 'Rejected'), ('escalated', 'Escalated to CFPB')], max_length=50, null=True)),
                ('outcome_details', models.JSONField(blank=True, default=dict)),
                ('bureau_response', models.TextField(blank=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('assigned_to', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assigned_disputes', to=settings.AUTH_USER_MODEL)),
                ('consumer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='disputes', to='customers.consumer')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_disputes', to=settings.AUTH_USER_MODEL)),
                ('tradeline', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='disputes', to='customers.tradeline')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='DisputeTask',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('type', models.CharField(choices=[('review_letter', 'Review Letter'), ('send_letter', 'Send Letter'), ('follow_up', 'Follow Up'), ('check_response', 'Check Bureau Response'), ('reinvestigate', 'Reinvestigation'), ('escalate', 'Escalate'), ('gather_evidence', 'Gather Evidence'), ('contact_consumer', 'Contact Consumer'), ('other', 'Other')], max_length=50)),
                ('title', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('due_at', models.DateTimeField()),
                ('reminder_at', models.DateTimeField(blank=True, null=True)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('cancelled', 'Cancelled')], default='pending', max_length=20)),
                ('priority', models.CharField(choices=[('low', 'Low'), ('normal', 'Normal'), ('high', 'High'), ('urgent', 'Urgent')], default='normal', max_length=20)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('completion_notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('assigned_to', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assigned_tasks', to=settings.AUTH_USER_MODEL)),
                ('completed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='completed_tasks', to=settings.AUTH_USER_MODEL)),
                ('dispute', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='tasks', to='tickets.dispute')),
            ],
            options={
                'ordering': ['due_at'],
            },
        ),
        migrations.CreateModel(
            name='Evidence',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('filename', models.CharField(max_length=255)),
                ('original_filename', models.CharField(max_length=255)),
                ('file_url', models.URLField(max_length=500)),
                ('file_size', models.PositiveIntegerField()),
                ('mime_type', models.CharField(max_length=100)),
                ('checksum_sha256', models.CharField(max_length=64)),
                ('virus_scanned', models.BooleanField(default=False)),
                ('virus_scan_result', models.CharField(blank=True, max_length=50)),
                ('evidence_type', models.CharField(choices=[('identity_document', 'Identity Document'), ('utility_bill', 'Utility Bill'), ('bank_statement', 'Bank Statement'), ('payment_receipt', 'Payment Receipt'), ('court_document', 'Court Document'), ('police_report', 'Police Report'), ('ftc_affidavit', 'FTC Identity Theft Affidavit'), ('correspondence', 'Correspondence'), ('credit_report', 'Credit Report'), ('screenshot', 'Screenshot'), ('other', 'Other')], max_length=50)),
                ('description', models.TextField(blank=True)),
                ('source', models.CharField(blank=True, max_length=50)),
                ('ocr_text', models.TextField(blank=True)),
                ('ocr_processed', models.BooleanField(default=False)),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('dispute', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='evidence', to='tickets.dispute')),
                ('uploaded_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name_plural': 'Evidence',
                'ordering': ['-uploaded_at'],
            },
        ),
        migrations.CreateModel(
            name='Letter',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('type', models.CharField(choices=[('fcra_609_request', 'FCRA 609 Information Request'), ('fcra_611_accuracy', 'FCRA 611 Dispute of Accuracy'), ('method_verification', 'Method of Verification Request'), ('reinvestigation', 'Reinvestigation Follow-up'), ('goodwill_adjustment', 'Goodwill Adjustment Request'), ('pay_for_delete', 'Pay for Delete Offer'), ('identity_theft_605b', 'Identity Theft Block (605B)'), ('cfpb_complaint', 'CFPB Complaint Package'), ('generic_dispute', 'Generic Dispute')], max_length=50)),
                ('subject', models.CharField(blank=True, max_length=255)),
                ('body_html', models.TextField()),
                ('body_text', models.TextField(blank=True)),
                ('pdf_url', models.URLField(blank=True, max_length=500)),
                ('pdf_hash', models.CharField(blank=True, max_length=64)),
                ('render_version', models.PositiveIntegerField(default=1)),
                ('rendered_at', models.DateTimeField(blank=True, null=True)),
                ('recipient_type', models.CharField(choices=[('bureau', 'Credit Bureau'), ('creditor', 'Creditor'), ('collector', 'Collection Agency'), ('cfpb', 'CFPB')], max_length=20)),
                ('recipient_name', models.CharField(max_length=255)),
                ('recipient_address', models.JSONField()),
                ('return_address', models.JSONField()),
                ('lob_id', models.CharField(blank=True, max_length=100)),
                ('lob_url', models.URLField(blank=True, max_length=500)),
                ('mail_type', models.CharField(blank=True, choices=[('first_class', 'First Class'), ('certified', 'Certified Mail'), ('certified_return_receipt', 'Certified Mail with Return Receipt')], max_length=50, null=True)),
                ('tracking_number', models.CharField(blank=True, max_length=100)),
                ('carrier', models.CharField(blank=True, max_length=50)),
                ('cost_printing', models.DecimalField(blank=True, decimal_places=2, max_digits=8, null=True)),
                ('cost_postage', models.DecimalField(blank=True, decimal_places=2, max_digits=8, null=True)),
                ('cost_total', models.DecimalField(blank=True, decimal_places=2, max_digits=8, null=True)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('pending_approval', 'Pending Approval'), ('approved', 'Approved'), ('rendering', 'Rendering PDF'), ('queued', 'Queued for Mailing'), ('sent', 'Sent'), ('in_transit', 'In Transit'), ('delivered', 'Delivered'), ('returned', 'Returned to Sender'), ('failed', 'Failed')], default='draft', max_length=20)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('sent_at', models.DateTimeField(blank=True, null=True)),
                ('expected_delivery', models.DateField(blank=True, null=True)),
                ('delivered_at', models.DateTimeField(blank=True, null=True)),
                ('returned_at', models.DateTimeField(blank=True, null=True)),
                ('return_reason', models.CharField(blank=True, max_length=100)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_letters', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_letters', to=settings.AUTH_USER_MODEL)),
                ('dispute', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='letters', to='tickets.dispute')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='LetterEvent',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('event_type', models.CharField(choices=[('created', 'Created'), ('rendered', 'PDF Rendered'), ('approved', 'Approved'), ('rejected', 'Rejected'), ('submitted_to_lob', 'Submitted to Lob'), ('mailed', 'Mailed'), ('in_transit', 'In Transit'), ('in_local_area', 'In Local Area'), ('processed_for_delivery', 'Processed for Delivery'), ('delivered', 'Delivered'), ('returned_to_sender', 'Returned to Sender'), ('failed', 'Failed')], max_length=50)),
                ('event_data', models.JSONField(blank=True, default=dict)),
                ('source', models.CharField(choices=[('system', 'System'), ('lob_webhook', 'Lob Webhook'), ('user', 'User Action'), ('smartcredit_webhook', 'SmartCredit Webhook')], max_length=50)),
                ('source_id', models.CharField(blank=True, max_length=100)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('letter', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='events', to='tickets.letter')),
            ],
            options={
                'ordering': ['created_at'],
            },
        ),
        migrations.CreateModel(
            name='LetterTemplate',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('name', models.CharField(max_length=255)),
                ('slug', models.SlugField(max_length=100)),
                ('type', models.CharField(choices=[('fcra_609_request', 'FCRA 609 Information Request'), ('fcra_611_accuracy', 'FCRA 611 Dispute of Accuracy'), ('method_verification', 'Method of Verification Request'), ('reinvestigation', 'Reinvestigation Follow-up'), ('goodwill_adjustment', 'Goodwill Adjustment Request'), ('pay_for_delete', 'Pay for Delete Offer'), ('identity_theft_605b', 'Identity Theft Block (605B)'), ('cfpb_complaint', 'CFPB Complaint Package'), ('generic_dispute', 'Generic Dispute')], max_length=50)),
                ('description', models.TextField(blank=True)),
                ('subject_template', models.CharField(blank=True, max_length=255)),
                ('body_html', models.TextField()),
                ('body_text', models.TextField(blank=True)),
                ('variables', models.JSONField(default=list)),
                ('version', models.PositiveIntegerField(default=1)),
                ('is_active', models.BooleanField(default=True)),
                ('is_default', models.BooleanField(default=False)),
                ('fcra_sections', models.JSONField(default=list)),
                ('disclaimer', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('tenant', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='letter_templates', to='customers.tenant')),
            ],
            options={
                'ordering': ['type', 'name'],
            },
        ),
        migrations.AddField(
            model_name='letter',
            name='template',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='tickets.lettertemplate'),
        ),
        migrations.CreateModel(
            name='Webhook',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('provider', models.CharField(choices=[('lob', 'Lob'), ('smartcredit', 'SmartCredit'), ('stripe', 'Stripe')], max_length=50)),
                ('event_type', models.CharField(max_length=100)),
                ('payload', models.JSONField()),
                ('headers', models.JSONField(blank=True, default=dict)),
                ('idempotency_key', models.CharField(max_length=255)),
                ('received_at', models.DateTimeField(auto_now_add=True)),
                ('processed_at', models.DateTimeField(blank=True, null=True)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('processing', 'Processing'), ('completed', 'Completed'), ('failed', 'Failed'), ('skipped', 'Skipped (Duplicate)')], default='pending', max_length=20)),
                ('error_message', models.TextField(blank=True)),
                ('retry_count', models.PositiveIntegerField(default=0)),
            ],
            options={
                'ordering': ['-received_at'],
                'indexes': [models.Index(fields=['provider', 'idempotency_key'], name='tickets_web_provide_d0bc81_idx'), models.Index(fields=['status'], name='tickets_web_status_b66dbb_idx')],
                'unique_together': {('provider', 'idempotency_key')},
            },
        ),
        migrations.AddIndex(
            model_name='dispute',
            index=models.Index(fields=['consumer', 'bureau'], name='tickets_dis_consume_015a6a_idx'),
        ),
        migrations.AddIndex(
            model_name='dispute',
            index=models.Index(fields=['status'], name='tickets_dis_status_43939c_idx'),
        ),
        migrations.AddIndex(
            model_name='dispute',
            index=models.Index(fields=['due_at'], name='tickets_dis_due_at_3bd0d5_idx'),
        ),
        migrations.AddIndex(
            model_name='dispute',
            index=models.Index(fields=['assigned_to'], name='tickets_dis_assigne_248a93_idx'),
        ),
        migrations.AddIndex(
            model_name='disputetask',
            index=models.Index(fields=['dispute'], name='tickets_dis_dispute_8cdf36_idx'),
        ),
        migrations.AddIndex(
            model_name='disputetask',
            index=models.Index(fields=['assigned_to', 'status'], name='tickets_dis_assigne_88301a_idx'),
        ),
        migrations.AddIndex(
            model_name='disputetask',
            index=models.Index(fields=['due_at'], name='tickets_dis_due_at_36fefc_idx'),
        ),
        migrations.AddIndex(
            model_name='evidence',
            index=models.Index(fields=['dispute', 'evidence_type'], name='tickets_evi_dispute_32e1b6_idx'),
        ),
        migrations.AddIndex(
            model_name='letterevent',
            index=models.Index(fields=['letter', 'event_type'], name='tickets_let_letter__44bfa5_idx'),
        ),
        migrations.AddIndex(
            model_name='lettertemplate',
            index=models.Index(fields=['tenant', 'type'], name='tickets_let_tenant__57b7e7_idx'),
        ),
        migrations.AddIndex(
            model_name='letter',
            index=models.Index(fields=['dispute'], name='tickets_let_dispute_2b7f72_idx'),
        ),
        migrations.AddIndex(
            model_name='letter',
            index=models.Index(fields=['status'], name='tickets_let_status_113670_idx'),
        ),
        migrations.AddIndex(
            model_name='letter',
            index=models.Index(fields=['lob_id'], name='tickets_let_lob_id_743414_idx'),
        ),
        migrations.AddIndex(
            model_name='letter',
            index=models.Index(fields=['sent_at'], name='tickets_let_sent_at_800818_idx'),
        ),
    ]
